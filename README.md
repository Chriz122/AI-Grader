# AI Grader - Automated Homework Grading System

[ÁπÅÈ´î‰∏≠Êñá](README_zh-TW.md) | English

This repository contains an automated Python homework grading system that uses a LLM (Large Language Model) to evaluate student Python assignments.

## Features

- ü§ñ Automatic grading of student Python assignments
- üìù Convert PDF problem statements to Markdown (supports LaTeX math)
- üìä Produce complete grading results and statistics
- üìà Export grades in a CSV format suitable for Excel
- üîÑ Automatic API key rotation to handle quota limits

## Project Structure

```
AI-Grader/
‚îú‚îÄ‚îÄ ai_grader/
‚îÇ   ‚îú‚îÄ‚îÄ api_key_manager.py        # Gemini API key manager
‚îÇ   ‚îú‚îÄ‚îÄ grader.py                 # Main program (calls Gemini for grading)
‚îÇ   ‚îú‚îÄ‚îÄ pdf2md.py                 # PDF -> Markdown utility for questions
‚îÇ   ‚îú‚îÄ‚îÄ gui_app.py                # GUI application for grading
‚îÇ   ‚îú‚îÄ‚îÄ plagiarism_or_not.py      # Plagiarism checking tool
‚îÇ   ‚îî‚îÄ‚îÄ hw2json.py                # student submissions -> JSON
‚îú‚îÄ‚îÄ data/                         # Original student submission folders and problem PDFs
‚îú‚îÄ‚îÄ knowledge/                    # Questions, grading criteria, output format
‚îÇ   ‚îú‚îÄ‚îÄ grading_criteria.md       # Grading criteria (customizable)
‚îÇ   ‚îú‚îÄ‚îÄ output_format.md          # Expected JSON fields returned by the LLM (customizable)
‚îÇ   ‚îú‚îÄ‚îÄ questions.md              # Questions (can be generated by pdf2md)
‚îÇ   ‚îî‚îÄ‚îÄ students_data.json        # Student data (ID, name)
‚îú‚îÄ‚îÄ RUN/                          # Program outputs
‚îÇ   ‚îú‚îÄ‚îÄ grading_results.json      # Grading output (JSON)
‚îÇ   ‚îú‚îÄ‚îÄ homework_scores.csv       # Grade sheet (CSV)
‚îÇ   ‚îú‚îÄ‚îÄ hw_all.json               # Consolidated student submissions (from hw2json)
‚îÇ   ‚îî‚îÄ‚îÄ plagiarism_report.md      # Plagiarism report (Markdown)
‚îú‚îÄ‚îÄ test/
‚îÇ   ‚îî‚îÄ‚îÄ test_create_prompt.py     # Validate prompt content (no API call required)
‚îî‚îÄ‚îÄ run_app.bat                   # Script to run the GUI application
```

## Installation & Setup

1) Install dependencies (Windows PowerShell):

```powershell
cd c:\Users\USER\Desktop\AI-Grader
pip install -r requirements.txt
```

2) Configure Gemini API Key(s)

The project supports both a single environment variable `GEMINI_API_KEY` and multiple keys managed in a `.env` file for automatic rotation when quotas are exhausted.

By default the program will look for numbered keys `GEMINI_API_KEY_1, GEMINI_API_KEY_2, ...` (in numeric order). If none are found it will fallback to a single `GEMINI_API_KEY`.

Recommended approach: copy or rename `.env.example` to `.env` in the project root and fill in your keys:

Example (multiple keys):

```
GEMINI_API_KEY_1 = "your_first_key_here"
GEMINI_API_KEY_2 = "your_second_key_here"
GEMINI_API_KEY_3 = "your_third_key_here"
```

Or with a single key:

```
GEMINI_API_KEY = "your_key_here"
```

Behavior summary:
- The program loads `GEMINI_API_KEY_<n>` keys starting from 1 and records how many are loaded. If no numbered keys are found it will try `GEMINI_API_KEY`.
- On API errors like 429 / RESOURCE_EXHAUSTED (quota exhausted), the grader will automatically switch to the next registered key and retry.
- If all registered keys are exhausted, the process will report failure and stop retrying.

Notes:
- Key rotation order follows the numeric index (1,2,3...). Fill them in according to the priority you want to use.
- If only `GEMINI_API_KEY` is provided, the system still works but will not auto-rotate keys.
- Manage API keys and quotas according to your provider‚Äôs policies.

- Obtain API keys here: https://aistudio.google.com/api-keys

3) Gemini Model Quotas

| Model | Category | RPM | TPM | RPD |
|-------|----------|-----|-----|-----|
| gemini-2.0-flash-exp | Text-out models | 0 / 10 | 0 / 250K | 0 / 50 |
| gemini-2.0-flash-lite | Text-out models | 0 / 30 | 0 / 1M | 0 / 200 |
| gemini-2.0-flash-preview-image-generation | Multi-modal generative models | 0 / 10 | 0 / 200K | 0 / 100 |
| gemini-2.0-flash | Text-out models | 0 / 15 | 0 / 1M | 0 / 200 |
| gemini-2.5-flash-lite | Text-out models | 0 / 15 | 0 / 250K | 0 / 1K |
| gemini-2.5-flash-tts | Multi-modal generative models | 0 / 3 | 0 / 10K | 0 / 15 |
| gemini-2.5-flash | Text-out models | 0 / 10 | 0 / 250K | 0 / 250 |
| gemini-2.5-pro | Text-out models | 0 / 2 | 0 / 125K | 0 / 50 |

## Quick Start

For Windows users, a batch script `run_app.bat` is provided for easy launching of the GUI application:

**Method 1: Double-click to run**
- Simply double-click `run_app.bat` in the project root directory to launch the GUI grading interface.

**Method 2: Command line**
```powershell
cd c:\Users\USER\Desktop\AI-Grader
.\run_app.bat
```

The script automatically:
- Activates the Python virtual environment
- Launches the GUI application (`gui_app.py`)
- Displays any errors if the environment is not properly set up

**Note:** Make sure you have completed the installation and API key configuration before running the application.

## Customization

- Edit `knowledge/grading_criteria.md` to adjust scoring details.
- Edit `knowledge/output_format.md` to define the LLM's JSON response format.
- Change the `MODEL_NAME` in `ai_grader/grader.py` „ÄÅ`ai_grader/plagiarism_or_not.py` to use a different Gemini model (default: `gemini-2.5-flash`).
- `knowledge/students_data.json` class lists which can be adjusted for your course.

## Testing (no API key required)

The `test/test_create_prompt.py` script generates a full LLM prompt and writes it to `test/test_output.md` without making any network calls:

```powershell
python test\test_create_prompt.py
```

## Troubleshooting

- "API key not configured" when running `grader.py`: ensure `.env` in the project root contains `GEMINI_API_KEY` or numbered keys.
- Connection errors: ensure the machine has internet access (Gemini API requires external connectivity).
- Missing student data: please confirm `knowledge/students_data.json` exists.
- Missing homework JSON: run `hw2json.py` first to generate `RUN/hw_all.json`.
- Missing questions Markdown: run `pdf2md.py` to generate `knowledge/questions.md`.

## Notes

- Grading time depends on the number of students and model latency. Test with a small subset first.
- Using LLMs may incur cost‚Äîmonitor usage and billing for your account.

## Contributing & License

Contributions and issues are welcome. See the repository license for details.